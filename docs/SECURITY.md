# Security Guide

## JWT Authentication

This API uses JWT (JSON Web Tokens) for authentication. All API endpoints require a valid JWT token in the `Authorization` header.

### 🔐 Token Generation (Secure Method)

**⚠️ IMPORTANT: Token generation is only available locally for authorized developers.**

#### Generate a Token

```bash
# Generate a default token
npm run generate-token

# Generate a token with custom payload
npm run generate-token -- --payload '{"sub":"user123","role":"admin"}'
```

#### Using the Token

```bash
# Set your token
export TOKEN="your-jwt-token-here"

# Use the token in API requests
curl -H "Authorization: Bearer $TOKEN" \
     "http://localhost:3003/api/health"
```

### 🛡️ Security Features

- **No Public Token Generation**: The `/api/generate-token` endpoint has been removed for security
- **Local Token Generation Only**: Tokens can only be generated by authorized developers locally
- **Token Expiration**: Tokens expire in 24 hours by default
- **Secure Storage**: Tokens are generated using the `WA_JWT_SECRET` environment variable

### 🔧 Environment Variables

Make sure to set the following environment variable:

```bash
WA_JWT_SECRET=your-secret-key-here
```

### 📋 Token Payload

Default token payload:
```json
{
  "sub": "admin-user",
  "iat": 1758610678,
  "exp": 1758697078,
  "role": "admin",
  "name": "Admin User"
}
```

### ⚠️ Security Best Practices

1. **Keep Tokens Secure**: Never share JWT tokens or commit them to version control
2. **Use Strong Secrets**: Use a strong, random `WA_JWT_SECRET`
3. **Rotate Tokens**: Generate new tokens regularly
4. **Monitor Access**: Keep track of who has access to token generation
5. **Local Development Only**: Token generation should only be available in development environments

### 🚫 What's NOT Available

- ❌ Public token generation endpoint
- ❌ Remote token generation
- ❌ Token generation without proper authentication
- ❌ Automatic token refresh

### 🔍 Troubleshooting

If you encounter authentication issues:

1. **Check Token Validity**: Ensure your token hasn't expired
2. **Verify Secret**: Make sure `WA_JWT_SECRET` is set correctly
3. **Check Format**: Ensure the Authorization header format is `Bearer <token>`
4. **Generate New Token**: If in doubt, generate a fresh token locally

### 📞 Support

For security-related questions or issues, contact the development team.
